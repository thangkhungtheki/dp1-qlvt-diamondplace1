(()=>{var t={550:(t,e,a)=>{const n=a(303),i=a(590),r=a(790),o=a(828),s=a(849),u=a(730),c=a(823);async function d(t,e){try{return await c.updateOne({tentb:t},e),!0}catch(t){return console.log(!1),!1}}async function h(t){let e=await s.find({Ma_vattu:t});var a=0;return e.forEach((t=>{let e=Number(t.soluong);a+=e})),a}async function y(t){let e=await u.find({Ma_vattu:t});var a=0;return e.forEach((t=>{let e=Number(t.soluong);a+=e})),a}t.exports={docUser:async function(){return await n.find()},find:async function(t){return"admin"==(await n.findOne({username:t})).role},docTb:async function(){return await i.find()},xoaTb:async function(t){try{return await i.deleteOne({Ma:t}),!0}catch(t){return t}},timTb:async function(t){return await i.findOne({Ma:t})},updatetb:async function(t,e){try{return await i.updateOne({Ma:t},e),!0}catch(t){return!1}},themtb:async function(t){try{return await i.create(t),!0}catch(t){return!1}},docTbdp2:async function(){return await r.find()},xoaTbdp2:async function(t){try{return await r.deleteOne({Ma:t}),!0}catch(t){return t}},timTbdp2:async function(t){return await r.findOne({Ma:t})},updatetbdp2:async function(t,e){try{return await r.updateOne({Ma:t},e),!0}catch(t){return!1}},themtbdp2:async function(t){try{return await r.create(t),!0}catch(t){return!1}},timvattu:async function(t){return await o.find({Loaivattu:t})},luunhapvattu:async function(t){try{return await s.create(t),!0}catch(t){return!1}},luuxuatvattu:async function(t){try{return await u.create(t),!0}catch(t){return!1}},luumavattu:async function(t){try{return await o.create(t),!0}catch(t){return!1}},timnhap:h,timxuat:y,timton:async function(t){return await h(t)-await y(t)},baocaovattu:async function(){let t=await async function(){return await o.find()}();var e=[];return await Promise.all(t.map((async t=>{let a=await h(t.Ma_vattu),n=await y(t.Ma_vattu),i=a-n,r={loai:t.Loaivattu,mavattu:t.Ma_vattu,tenvattu:t.Tenvattu,nhap:a,xuat:n,ton:i};e.push(r)}))),e},timxuatvattu:async function(t){return await u.find({loai:t})},doc_createthietbi:async function(){return await c.find()},them_createthietbi:async function(t){try{return await c.create(t),!0}catch(t){return!1}},sua_createthietbi:d,xoa_createthietbi:async function(t){try{return await c.deleteOne({tentb:t}),!0}catch(t){return t}},tim_createthietbi:async function(t){return await c.findOne({tentb:t})||!1},sua_createthietbi:d,timUser:async function(t){return await n.findOne({username:t})},tim_createthietbi_baotridinhky:async function(t){return await c.find({ghichu:t})||!1}}},152:(t,a,n)=>{const i=n(782),r=n(911);async function o(t){try{return await i.find({mayeucau:t})}catch(t){return!1}}t.exports={taoyc:async function(t){try{return await i.create(t),!0}catch(t){return!1}},docyeucautheotrangthai:async function(t,e){try{return await i.find({ttbp:t,bophan:e})}catch(t){return!1}},updatetttbp:async function(t,e){try{await i.updateOne({mayeucau:t},{$set:{ttbp:e}})}catch(t){return console.log(t),!1}},timyctheoma:o,deletettbp:async function(t){try{let e=await o(t);e&&(e[0].filename.forEach((t=>{r.xoafile(t.path)})),await i.deleteOne({mayeucau:t}))}catch(t){return console.log(t),!1}},timyctheobophan:async function(t){try{return await i.find({bophan:t,ttbp:"duyet",$or:[{trangthai:{$ne:"hoanthanh"}}]})}catch(t){return!1}},updatekythuat:async function(t,a,n,r){const o={upsert:!0,new:!0},s={$push:{fileanhdonhang:{$each:r}},$set:{trangthai:a,motakythuat:n}};try{await i.updateOne({mayeucau:t},s,o)}catch(t){return console.log(e),!1}},_updatetrangthai:async function(t,e){try{return await i.updateOne({mayeucau:t},{$set:{trangthai:e}}),!0}catch(t){return console.log(t),!1}},_doctatcayeucauhoanthanh:async function(t){try{return await i.find({trangthai:t})}catch(t){return!1}},_deletephongkythuat:async function(t){try{let e=await o(t);return e&&(e[0].filename.forEach((t=>{r.xoafile(t.path)})),e[0].fileanhdonhang.forEach((t=>{r.xoafile(t.path)})),await i.deleteOne({mayeucau:t})),!0}catch(t){return console.log(t),!1}},_updatefeedback:async function(t,e,a){try{return await i.updateOne({mayeucau:t},{$set:{diem:e,feedback:a}}),!0}catch(t){return!1}}}},911:(t,e,a)=>{const n=a(896);t.exports={xoafile:function(t){n.unlink(t,(t=>{t?console.error(`Lỗi khi xóa tệp tin: ${t}`):console.log("Tệp tin đã được xóa thành công")}))}}},574:(t,e,a)=>{a(818).config(),a(140);var n=a(252),i=a(3),r=a(898),o=a(977),s=a(37),u=a(278),c=a(925),d=n(),h=(a(461),a(414)),y=a(677);s.connect(process.env.DATABASE_URL,{useNewUrlParser:!0,useUnifiedTopology:!0}),a(736),d.use(o({secret:"thangkhungtheki",resave:!1,saveUninitialized:!1})),d.use(c()),d.use(u.initialize()),d.use(u.session()),d.set("views",i.join(__dirname,"views")),d.set("view engine","ejs"),d.use(n.json()),d.use(n.urlencoded({extended:!1})),d.use(r()),d.use(n.static(i.join(__dirname,"public"))),d.use(n.static(i.join(__dirname,"uploads"))),d.use("/",h),d.use("/qlkt/",y),d.use(((t,e,a)=>{e.status(404).redirect("/signin")})),t.exports=d},736:(t,e,a)=>{var n=a(278),i=a(303),r=a(752).Strategy;n.serializeUser((function(t,e){e(null,t.id)})),n.deserializeUser((function(t,e){i.findById(t,(function(t,a){e(t,a)}))})),n.use("local.signup",new r({usernameField:"username",passwordField:"password",passReqToCallback:!0},(function(t,e,a,n){i.findOne({username:e},(function(t,r){if(t)return n(t);if(r)return n(null,!1,{message:"username is already in use."});var o=new i;o.username=e,o.password=o.enscryptPassword(a),o.save((function(t,e){return t?n(t):n(null,o)}))}))}))),n.use("local.signin",new r({usernameField:"username",passwordField:"password",passReqToCallback:!0},(function(t,e,a,n){i.findOne({username:e},(function(t,e){return t?n(t):e?e.validPassword(a,e.password)?n(null,e):n(null,!1,{message:"Wrong password"}):n(null,!1,{message:"Not user found"})})).clone}))),t.exports=n},823:(t,e,a)=>{const n=a(37),i=new(0,n.Schema)({username:{type:String,required:!0},tentb:{type:String,required:!0},dvt:{type:String,required:!1},soluong:{type:String,required:!1},ngaynhap:{type:String,required:!1},timehethan:{type:String,required:!1},ngayhethan:{type:String,require:!1},tenncc:{type:String,require:!1},sdtncc:{type:String,require:!1},tinhtrang:{type:String,require:!1},ghichu:{type:String,required:!1},songayhethan:{type:String,require:!1}});t.exports=n.model("createthietbi",i,"createthietbi")},849:(t,e,a)=>{const n=a(37),i=new(0,n.Schema)({Ma_vattu:{type:String,required:!0},Tenvattu:{type:String,required:!1},username:{type:String,required:!1},ngaynhap:{type:String,required:!1},soluong:{type:String,required:!1},ghichu:{type:String,require:!1},loai:{type:String,required:!1}});t.exports=n.model("nhapvattu",i,"nhapvattu")},790:(t,e,a)=>{const n=a(37),i=n.Schema,r=(a(486),new i({Ma:{type:String,required:!0},Mainboard:{type:String,required:!1},RAM:{type:String,required:!1},CPU:{type:String,required:!1},HardDisk:{type:String,required:!1},Monitor:{type:String,required:!1},VideoCard:{type:String,required:!1},OS:{type:String,required:!1},Notes:{type:String,required:!1},BoPhan:{type:String,required:!1},DeXuat:{type:String,required:!1},Loai:{type:String,required:!1},Nguoidung:{type:String,required:!1},Vitri:{type:String,required:!1}}));t.exports=n.model("thietbidp2",r,"thietbidp2")},590:(t,e,a)=>{const n=a(37),i=n.Schema,r=(a(486),new i({Ma:{type:String,required:!0},Mainboard:{type:String,required:!1},RAM:{type:String,required:!1},CPU:{type:String,required:!1},HardDisk:{type:String,required:!1},Monitor:{type:String,required:!1},VideoCard:{type:String,required:!1},OS:{type:String,required:!1},Notes:{type:String,required:!1},BoPhan:{type:String,required:!1},DeXuat:{type:String,required:!1},Loai:{type:String,required:!1},Nguoidung:{type:String,required:!1},Vitri:{type:String,required:!1}}));t.exports=n.model("thietbi",r,"thietbi")},303:(t,e,a)=>{const n=a(37),i=n.Schema,r=a(486),o=new i({username:{type:String,required:!0},password:{type:String,required:!0},role:{type:String,required:!1},bp:{type:String,required:!1}});o.methods.enscryptPassword=t=>r.hashSync(t,r.genSaltSync(5),null),o.methods.validPassword=(t,e)=>r.compareSync(t,e),t.exports=n.model("User",o)},828:(t,e,a)=>{const n=a(37),i=new(0,n.Schema)({Ma_vattu:{type:String,required:!0},Tenvattu:{type:String,required:!1},Loaivattu:{type:String,required:!1}});t.exports=n.model("vattu",i,"vattu")},730:(t,e,a)=>{const n=a(37),i=new(0,n.Schema)({Ma_vattu:{type:String,required:!0},Tenvattu:{type:String,required:!1},username:{type:String,required:!1},ngayxuat:{type:String,required:!1},soluong:{type:String,required:!1},lydoxuat:{type:String,require:!1},loai:{type:String,required:!1}});t.exports=n.model("xuatvattu",i,"xuatvattu")},782:(t,e,a)=>{const n=a(37),i=new(0,n.Schema)({mayeucau:{type:String,required:!0},nguoiyeucau:{type:String,required:!0},ngayyeucau:{type:String,required:!0},bophan:{type:String,required:!1},dienthoai:{type:String,required:!1},vitri:{type:String,required:!0},khancap:{type:String,required:!1},mota:{type:String,required:!0},ttbp:{type:String,required:!1},trangthai:{type:String,required:!1},motacongviec:{type:String,required:!1},note:{type:String,required:!1},filename:{type:Array,required:!1},motakythuat:{type:String,require:!1},fileanhdonhang:{type:Array,required:!1},ngayhoanthanh:{type:String,required:!1},feedback:{type:String,required:!1},diem:{type:Number,required:!1}});t.exports=n.model("yeucausuachua",i,"yeucausuachua")},546:(t,e,a)=>{const n=a(461),i=a(3).join(__dirname,"uploads"),r=n.diskStorage({destination:i,filename:(t,e,a)=>{const n=new Date;a(null,`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}-${n.getHours().toString().padStart(2,"0")}-${n.getMinutes().toString().padStart(2,"0")}-${n.getSeconds().toString().padStart(2,"0")}-${e.originalname.replace(/[^\w.-]/g,"")}`)}}),o=n({storage:r});t.exports={upload:o,handleError:(t,e,a,n)=>{if(t)return console.log(e.files.length),a.status(500).json({error:"Lỗi server. File đã vượt quá số lượng cho phép "});n()}}},677:(t,e,a)=>{var n=a(252).Router(),i=a(550);const r=a(152),o=a(546),s=a(385);var u=process.env.DATABASE_URL;async function c(){let t=await r.timyctheobophan("bep"),e=await r.timyctheobophan("sales"),a=await r.timyctheobophan("mar"),n=await r.timyctheobophan("fb"),i=await r.timyctheobophan("ketoan"),o=await r.timyctheobophan("av"),s=await r.timyctheobophan("house"),u=await r.timyctheobophan("nhansu"),c=await r.timyctheobophan("khac");return{bep:t.length,sales:e.length,mar:a.length,fb:n.length,ketoan:i.length,av:o.length,house:s.length,nhansu:u.length,khac:c.length}}function d(t,e,a){if(t.isAuthenticated())return a();e.redirect("/login")}function h(t,e,a){if(t.isAuthenticated()&&("admin"==t.user.role||"root"==t.user.role))return a();e.redirect("/signin")}n.use((async(t,e,a)=>{let n=await c();e.locals.arrayTong=n,a()})),n.get("/backupdatabase",(async(t,e)=>{await s.backupMongo(u,(()=>{})),e.send("ok done")})),n.get("/rootyeucau",(function(t,e,a){if(t.isAuthenticated()){if("root"==t.user.role)return a();e.redirect("/qlkt/bieudotron")}e.redirect("/signin")}),(async(t,e)=>{const a=t.flash("success")[0];e.render("rootadmin/main-yeucau",{data:t.user,successMessage:a})})),n.get("/",(async(t,e)=>{if(t.isAuthenticated()){let a=await i.timUser(t.user.username);switch(a.role){case"root":case"admin":e.redirect("/qlkt/bieudotron");break;case"tp":let n=await r.docyeucautheotrangthai("dangxuly",a.bp);e.render("layoutkythuat/main/dashboard",{data:n});break;case"nv":const i=t.flash("success")[0];e.render("layoutkythuat/user/dashboard",{data:a,successMessage:i});break;default:e.send("bạn đã Đăng ký thành công!!! <br> Chào bạn: <b>"+a.username+" </b>, vui lòng liên hệ admin và báo tên user, để được cấp quyền")}}else e.redirect("/signin")})),n.post("/taoyc",o.upload.array("image",4),o.handleError,(async(t,e)=>{if(t.isAuthenticated())try{var a=t.files,n=t.body.code;if("khac"===t.body.bophan)var i="duyet",o="TP KyThuat";else i="dangxuly",o=t.body.vitri;let s={mayeucau:n.replace(/\+/g," "),nguoiyeucau:t.body.nguoiyc,ngayyeucau:t.body.ngay,bophan:t.body.bophan,dienthoai:t.body.dienthoai,vitri:o,khancap:t.body.option,mota:t.body.areamota,ttbp:i,trangthai:"choduyet",filename:a};1==await r.taoyc(s)?(t.flash("success","Dữ liệu đã được lưu và gửi thành công!"),e.redirect("/qlkt")):(t.flash("success","Chưa lưu, cần nhập đầy đủ thông tin vào !"),e.redirect("/qlkt"))}catch(t){console.log(t),e.send("Lỗi không xác định ")}else e.redirect("/signin")})),n.post("/updatettbp",(async(t,e)=>{let a=t.body.mayeucau;console.log(a),await r.updatetttbp(a,"duyet"),e.end()})),n.post("/deletettbp",(async(t,e)=>{let a=t.body.mayeucau;console.log("đã xoá: "+a),await r.deletettbp(a),e.end()})),n.post("/deletephongkythuat",h,(async(t,e)=>{let a=t.body.mayeucau;console.log("đã xoá: "+a),await r._deletephongkythuat(a),e.send(!0)})),n.get("/xemlichsu",d,(async(t,e)=>{let a=await i.timUser(t.user.username);switch(a.role){case"admin":e.redirect("/vattutest");break;case"tp":let n=await r.docyeucautheotrangthai("duyet",a.bp);e.render("layoutkythuat/main/viewxemlichsu",{data:n});break;case"nv":const i=t.flash("success")[0];e.render("layoutkythuat/user/dashboard",{data:a,successMessage:i});break;default:e.send("bạn đã Đăng ký thành công!!! <br> Chào bạn: <b>"+a.username+" </b>, vui lòng liên hệ admin và báo tên user, để được cấp quyền")}})),n.get("/viewyeucau",d,(async(t,e)=>{let a=await i.timUser(t.user.username);const n=t.flash("success")[0];e.render("layoutkythuat/main/view_guiyc",{data:a,successMessage:n})})),n.get("/info",d,(async(t,e)=>{var a=await i.timUser(t.user.username);let n=t.query.mayeucau,o=await r.timyctheoma(n);o&&e.render("layoutkythuat/main/view_info",{data:o,user:a,myPathENV:process.env.myPathENV})})),n.get("/viewtheobophan_daduyet",h,(async(t,e)=>{let a=t.query.bophan,n=await r.timyctheobophan(a);n&&e.render("mainSbAdmin/viewsuachuatheophong",{data:n,_username:""})})),n.get("/bieudotron",h,(async(t,e)=>{let a=await c();e.render("rootadmin/bangduyetpyc",{_username:"",total:a})})),n.get("/tonghophoanthanh",h,(async(t,e)=>{let a=await r._doctatcayeucauhoanthanh("hoanthanh");a&&e.render("mainSbAdmin/viewsuachuatheophong",{data:a,_username:""})})),n.post("/updatekythuat",o.upload.array("image2",4),o.handleError,(async(t,e)=>{if(t.isAuthenticated())try{let a=t.files,n=t.body.code,i=t.body.motacuakythuat;await r.updatekythuat(n,"dangxuly",i,a),e.redirect("/qlkt/info?mayeucau="+n)}catch(t){e.send(t)}else e.redirect("/signin")})),n.post("/updatehoanthanh",(async(t,e)=>{if(t.isAuthenticated())try{let a=t.body.code,n=t.body.trangthai,i=await r._updatetrangthai(a,n);e.send(i)}catch(t){}})),n.post("/updatefeedback",d,(async(t,e)=>{try{let a=t.body.mayeucau,n=t.body.diem,i=t.body.feedback,o=await r._updatefeedback(a,n,i);e.send(o)}catch(t){}})),n.get("/tongsuachuaton",(async(t,e)=>{let a=await c();e.json({total:a})})),t.exports=n},414:(t,e,a)=>{var n=a(252).Router(),i=a(736),r=a(550),o=a(716);const s=a(152),u=a(834);async function c(t){var e=[];for(let a=0;a<t.length;a++){let n=o().format("YYYY-MM-DD"),i=o(t[a].ngayhethan).diff(n,"days");t[a].songayhethan=i-1,e.push(t[a])}return e}n.use((async(t,e,a)=>{let n=await async function(){let t=await s.timyctheobophan("bep"),e=await s.timyctheobophan("sales"),a=await s.timyctheobophan("mar"),n=await s.timyctheobophan("fb"),i=await s.timyctheobophan("ketoan"),r=await s.timyctheobophan("av"),o=await s.timyctheobophan("house"),u=await s.timyctheobophan("nhansu"),c=await s.timyctheobophan("khac");return{bep:t.length,sales:e.length,mar:a.length,fb:n.length,ketoan:i.length,av:r.length,house:o.length,nhansu:u.length,khac:c.length}}();e.locals.arrayTong=n,a()})),n.get("/cronjobsendmail",(async(t,e)=>{var a=await r.doc_createthietbi(),n=await c(a);n?(u.sendmail(n),e.status(200).send("ok")):e.status(200).send("ko gửi mail")})),n.get("/",((t,e,a)=>{e.redirect("/signin")})),n.get("/signin",((t,e,a)=>{var n=t.flash("error");e.render("signin",{messages:n,hasErrors:n.length>0})})),n.get("/createthietbi",((t,e)=>{t.isAuthenticated()?e.render("mainSbAdmin/createthietbi",{_username:t.user.username,data:"data",activeuser:"active",activetb:"",activetbdp2:""}):e.redirect("/signin")})).post("/themcreatethietbi",((t,e)=>{if(t.isAuthenticated()){var a=o(t.body.ngaynhap),n=t.body.timehethan;const s=a.add(n,"months");var i={username:t.user.username,tentb:t.body.tentb,dvt:t.body.dvt,soluong:t.body.soluong,ngaynhap:t.body.ngaynhap,timehethan:t.body.timehethan,ngayhethan:s.format("YYYY-MM-DD"),tenncc:t.body.tenncc,sdtncc:t.body.sdtncc,tinhtrang:t.body.tinhtrang,ghichu:t.body.ghichu};try{r.them_createthietbi(i),e.redirect("/createthietbi")}catch{}}else e.redirect("/signin")})),n.post("/xoathietbi",h,(async(t,e)=>{if(t.isAuthenticated()){let a=t.body.tentb;await r.xoa_createthietbi(a),e.end()}else e.redirect("/signin")})),n.get("/suacreatethietbi",(async(t,e)=>{let a=t.query.tentb;if(t.isAuthenticated()){var n=await r.tim_createthietbi(a);e.render("mainSbAdmin/createthietbi-sua",{_username:t.user.username,data:n,activeuser:"",activetb:"",activetbdp2:"active"})}else e.redirect("/signin")})).post("/suacreatethietbi",h,(async(t,e)=>{if(t.isAuthenticated()){var a=o(t.body.ngaynhap),n=t.body.timehethan;const s=a.add(n,"months");var i={username:t.user.username,tentb:t.body.tentb,dvt:t.body.dvt,soluong:t.body.soluong,ngaynhap:t.body.ngaynhap,timehethan:t.body.timehethan,tenncc:t.body.tenncc,sdtncc:t.body.sdtncc,tinhtrang:t.body.tinhtrang,ghichu:t.body.ghichu,ngayhethan:s.format("YYYY-MM-DD")};try{await r.sua_createthietbi(i.tentb,i),e.redirect("/viewcreatethietbi")}catch{}}else e.redirect("/signin")})),n.get("/viewcreatethietbi",(async(t,e)=>{if(t.isAuthenticated()){var a=await r.doc_createthietbi(),n=await c(a);const i=o().format("DD-MM-YYYY");e.render("mainSbAdmin/createthietbiview",{_username:t.user.username,data:n,activeuser:"",activetb:"",activetbdp2:"active",daynow:i})}else e.redirect("/signin")})),n.get("/baotridinhky",(async(t,e)=>{if(t.isAuthenticated()){var a=await r.tim_createthietbi_baotridinhky("Bảo trì định kỳ"),n=await c(a);const i=o().format("DD-MM-YYYY");e.render("mainSbAdmin/createthietbiview_baotridinhky",{_username:t.user.username,data:n,activeuser:"",activetb:"",activetbdp2:"active",daynow:i})}else e.redirect("/signin")})).post("/baotridinhky",(async(t,e)=>{if(t.isAuthenticated()){let i=o().format("YYYY-MM-DD");var a=t.body.timehethan;let s=o(i).add(a,"months").format("YYYY-MM-DD");var n={username:t.user.username,tentb:t.body.tentb,ngaynhap:i,ngayhethan:s};try{await r.sua_createthietbi(n.tentb,n),e.redirect("/baotridinhky")}catch{}}else e.redirect("/signin")})),n.post("/signin",i.authenticate("local.signin",{successRedirect:"/qlkt",failureRedirect:"/signin",failureFlash:!0})),n.post("/signup",i.authenticate("local.signup",{successRedirect:"/signin",failureRedirect:"/signup",failureFlash:!0})),n.get("/signup",(function(t,e,a){var n=t.flash("error");e.render("signup",{messages:n,hasErrors:n.length>0})})),n.get("/dashboard",(function(t,e,a){if(t.isAuthenticated()&&("admin"==t.user.role||"root"==t.user.role))return a();e.redirect("/signin")}),(async(t,e)=>{let a=await r.docUser();e.render("mainSbAdmin/dashboard",{_username:t.user.username,data:a,activeuser:"active",activetb:"",activetbdp2:""})})),n.get("/thietbi",(async(t,e)=>{if(t.isAuthenticated()){let a=await r.docTb();e.render("mainSbAdmin/dbthietbi",{_username:t.user.username,data:a,activeuser:"",activetb:"active",activetbdp2:""})}else e.redirect("/signin")}));var d={Ma:"",Mainboard:"",RAM:"",CPU:"",HardDisk:"",Monitor:"",VideoCard:"",OS:"",Notes:"",BoPhan:"",DeXuat:"",Loai:"",Nguoidung:"",Vitri:""};function h(t,e,a){if(t.isAuthenticated()&&"root"==t.user.role)return a();e.redirect("/signin")}n.get("/editthietbi",(async(t,e)=>{e.render("mainSbAdmin/dbthietbi-edit",{_username:t.user.username,activeuser:"",activetb:"",activetbdp2:"active",data:d})})),n.get("/thietbidp2",(async(t,e)=>{if(t.isAuthenticated()){let a=await r.docTbdp2();e.render("mainSbAdmin/dbthietbidp2",{_username:t.user.username,data:a,activeuser:"",activetb:"",activetbdp2:"active"})}else e.redirect("/signin")})),n.post("/suatb",(async(t,e)=>{e.render("mainSbAdmin/dbthietbi-edit",{_username:t.user.username,activeuser:"",activetb:"",activeedittb:"active",Ma:t.body.code})})),n.post("/suatbdp2",(async(t,e)=>{e.render("mainSbAdmin/dbthietbi-edit-dp2",{_username:t.user.username,activeuser:"",activetb:"",activeedittb:"",activetbdp2:"",Ma:t.body.code})})),n.post("/delete",(async(t,e)=>{t.isAuthenticated()?1==await r.xoaTb(t.body.Ma)?e.redirect("/thietbi"):e.send("Loi khong xoa duoc"):e.redirect("/signin")})),n.post("/deletedp2",(async(t,e)=>{t.isAuthenticated()?1==await r.xoaTbdp2(t.body.Ma)?e.redirect("/thietbidp2"):e.send("Loi khong xoa duoc"):e.redirect("/signin")})),n.post("/searchedit",(async(t,e)=>{let a=await r.timTb(t.body.txtsearch);a?e.render("mainSbAdmin/dbthietbi-edit",{_username:t.user.username,activeuser:"",activetb:"",activeedittb:"active",activetbdp2:"",data:a}):e.render("mainSbAdmin/dbthietbi-edit",{_username:t.user.username,activeuser:"",activetb:"",activeedittb:"active",activetbdp2:"",data:d})})),n.post("/searcheditdp2",(async(t,e)=>{let a=await r.timTbdp2(t.body.txtsearch);a?e.render("mainSbAdmin/dbthietbi-edit-dp2",{_username:t.user.username,activeuser:"",activetb:"",activeedittb:"active",activetbdp2:"",data:a}):e.render("mainSbAdmin/dbthietbi-edit-dp2",{_username:t.user.username,activeuser:"",activetb:"",activeedittb:"active",activetbdp2:"",data:d})})),n.get("/themthietbi",((t,e)=>{t.isAuthenticated()?e.render("mainSbAdmin/themthietbi",{_username:t.user.username,activeuser:"",activetb:"",activeedittb:"",activetbdp2:"",activethem:""}):e.redirect("/signin")})),n.get("/themthietbidp2",((t,e)=>{t.isAuthenticated()?e.render("mainSbAdmin/themthietbidp2",{_username:t.user.username,activeuser:"",activetb:"",activetbdp2:"",activethem:"active"}):e.redirect("/signin")})),n.post("/themtb",((t,e)=>{let a={Ma:t.body.txtma,Mainboard:t.body.txtmain,RAM:t.body.txtram,CPU:t.body.txtcpu,HardDisk:t.body.txthdd,Monitor:t.body.txtmonitor,VideoCard:t.body.txtvideo,OS:t.body.txtOS,Notes:t.body.txtnotes,BoPhan:t.body.txtbophan,DeXuat:t.body.txtdexuat,Loai:t.body.txtloai,Nguoidung:t.body.txtnguoidung,Vitri:t.body.txtvitri};r.themtb(a),e.redirect("/themthietbi")})),n.post("/themtbdp2",((t,e)=>{let a={Ma:t.body.txtma,Mainboard:t.body.txtmain,RAM:t.body.txtram,CPU:t.body.txtcpu,HardDisk:t.body.txthdd,Monitor:t.body.txtmonitor,VideoCard:t.body.txtvideo,OS:t.body.txtOS,Notes:t.body.txtnotes,BoPhan:t.body.txtbophan,DeXuat:t.body.txtdexuat,Loai:t.body.txtloai,Nguoidung:t.body.txtnguoidung,Vitri:t.body.txtvitri};r.themtbdp2(a),e.redirect("/themthietbidp2")})),n.post("/capnhat",((t,e)=>{let a={Mainboard:t.body.txtmain,RAM:t.body.txtram,CPU:t.body.txtcpu,HardDisk:t.body.txthdd,Monitor:t.body.txtmonitor,VideoCard:t.body.txtvideo,OS:t.body.txtOS,Notes:t.body.txtnotes,BoPhan:t.body.txtbophan,DeXuat:t.body.txtdexuat,Loai:t.body.txtloai,Nguoidung:t.body.txtnguoidung,Vitri:t.body.txtvitri};r.updatetb(t.body.txtma,a),e.redirect("/thietbi")})),n.post("/capnhatdp2",((t,e)=>{let a={Mainboard:t.body.txtmain,RAM:t.body.txtram,CPU:t.body.txtcpu,HardDisk:t.body.txthdd,Monitor:t.body.txtmonitor,VideoCard:t.body.txtvideo,OS:t.body.txtOS,Notes:t.body.txtnotes,BoPhan:t.body.txtbophan,DeXuat:t.body.txtdexuat,Loai:t.body.txtloai,Nguoidung:t.body.txtnguoidung,Vitri:t.body.txtvitri};r.updatetbdp2(t.body.txtma,a),e.redirect("/thietbidp2")})),n.post("/logout",((t,e)=>{t.session.destroy(),e.redirect("/signin")})),n.get("/vattutest",((t,e)=>{t.isAuthenticated()?e.render("mainSbAdmin/vattu.ejs",{user:t.user,_username:t.user.username,activeuser:"",activetb:"",activetbdp2:"",activethem:"active"}):e.redirect("signin")})),n.post("/timvattubyloai",(async(t,e)=>{let a=t.body.loai,n=await r.timvattu(a);e.send(n)})),n.post("/luunhapvattu",(async(t,e)=>{let a={Ma_vattu:t.body.Ma_vattu,Tenvattu:t.body.Tenvattu,username:t.user.username,ngaynhap:t.body.ngaynhap,soluong:t.body.soluong,ghichu:t.body.ghichu,loai:t.body.loai};console.log(a),await r.luunhapvattu(a),e.redirect("/vattutest")})),n.get("/xuatvattutest",((t,e)=>{t.isAuthenticated()?e.render("mainSbAdmin/xuatvattu.ejs",{user:t.user,_username:t.user.username,activeuser:"",activetb:"",activetbdp2:"",activethem:""}):e.redirect("signin")})),n.post("/luuxuatvattu",(async(t,e)=>{let a={Ma_vattu:t.body.Ma_vattu,Tenvattu:t.body.Tenvattu,username:t.user.username,ngayxuat:t.body.ngayxuat,soluong:t.body.soluong,lydoxuat:t.body.lidoxuat,loai:t.body.loai};console.log(a),await r.luuxuatvattu(a),e.redirect("/xuatvattutest")})),n.get("/mavattutest",((t,e)=>{t.isAuthenticated()?e.render("mainSbAdmin/themmavattu.ejs",{user:t.user,_username:t.user.username,activeuser:"",activetb:"",activetbdp2:"",activethem:""}):e.redirect("signin")})),n.post("/luumavattu",(async(t,e)=>{let a={Ma_vattu:t.body.mavattu,Tenvattu:t.body.tenvattu,Loaivattu:t.body.loaivattu};console.log(a),await r.luumavattu(a),e.redirect("/mavattutest")})),n.get("/timnhap",(async(t,e)=>{let a=await r.timnhap("dl-04");console.log(a),e.send(200,a)})),n.get("/timton/:ma",(async(t,e)=>{let a=t.params.ma,n=await r.timnhap(a);console.log("số lương nhập: "+n);let i=await r.timxuat(a);console.log("Số lượng xuất: "+i);let o=n-i;e.send({slxuat:i,slnhap:n,slton:o})})),n.get("/baocaovattu",(async(t,e)=>{if(t.isAuthenticated()){let a=await r.baocaovattu();e.render("mainSbAdmin/baocaovattu.ejs",{user:t.user,activeuser:"",activetb:"",activetbdp2:"",activethem:"",data:a})}else e.redirect("signin")})),n.get("/chart",((t,e)=>{e.render("mainSbAdmin/main-chart.ejs",{user:t.user,activeuser:"",activetb:"",activetbdp2:"",activethem:""})})),n.get("/chitiettheoma",(async(t,e)=>{t.isAuthenticated()?(await r.baocaovattu(),e.render("mainSbAdmin/chitiettheoma_tenuser",{user:t.user,activeuser:"",activetb:"",activetbdp2:"",activethem:""})):e.redirect("signin")})),n.post("/timxuatvattu",(async(t,e)=>{let a=await r.timxuatvattu(t.body.loai);e.send(a)})),n.get("/dathang",(async(t,e)=>{t.isAuthenticated()?(await r.baocaovattu(),e.render("mainSbAdmin/themdathang",{user:t.user,activeuser:"",activetb:"",activetbdp2:"",activethem:""})):e.redirect("signin")})),t.exports=n},834:(t,e,a)=>{const n=a(572);var i=a(716);t.exports={sendmail:function(t){var e,a=n.createTransport({host:process.env.hostEmail,port:process.env.portEmail,type:"login",secure:!0,auth:{user:process.env.emailFrom,pass:process.env.emailPass},tls:{rejectUnauthorized:!1}}),r="";for(let e=0;e<t.length;e++)t[e].songayhethan<=30&&t[e].songayhethan>0&&(r+="<b>.Tên: </b><span style='color: blue'>"+t[e].tentb+' </span>\n                            <span> ---day: </span>\n                            <span style="color: red">'+t[e].songayhethan+" ngày </span> <br>");if(""!=(e=r)){var o={from:process.env.emailFrom,to:process.env.mailList,subject:process.env.subject,html:e};a.sendMail(o,(function(t,e){t?console.log(t):console.log("Message sent: send mail Success")}))}else{let t=i().format("YYYY-MM-DD");console.log("Date: "+t+"Ko có hết hạn")}}}},385:(t,e,a)=>{const{exec:n}=a(317);a(818).config();const i=a(3).dirname(__filename);t.exports={restoremongo:function(t){const e=t,a="/backup/archive.gz";e||(console.error("DATABASE_URL is not defined in the environment variables."),process.exit(1)),n(`mongorestore --uri "${e}" --gzip --archive=${a}`,((t,e,n)=>{t?console.error(`Error: ${t.message}`):console.log(`Restore successful from: ${a}`)}))},backupMongo:function(t,e){const a=t,r=i;if(!a){const t=new Error("DATABASE_URL is not defined in the environment variables.");return e(t)}n(`mongodump --uri "${a}" --archive=${r} --gzip`,((t,a,n)=>{if(t)return e(t);console.log(`Backup successful. Exported to: ${r}`)}))}}},486:t=>{"use strict";t.exports=require("bcrypt")},925:t=>{"use strict";t.exports=require("connect-flash")},898:t=>{"use strict";t.exports=require("cookie-parser")},818:t=>{"use strict";t.exports=require("dotenv")},252:t=>{"use strict";t.exports=require("express")},977:t=>{"use strict";t.exports=require("express-session")},140:t=>{"use strict";t.exports=require("http-errors")},716:t=>{"use strict";t.exports=require("moment")},37:t=>{"use strict";t.exports=require("mongoose")},461:t=>{"use strict";t.exports=require("multer")},572:t=>{"use strict";t.exports=require("nodemailer")},278:t=>{"use strict";t.exports=require("passport")},752:t=>{"use strict";t.exports=require("passport-local")},3:t=>{"use strict";t.exports=require("path")},317:t=>{"use strict";t.exports=require("child_process")},896:t=>{"use strict";t.exports=require("fs")}},a={};function n(e){var i=a[e];if(void 0!==i)return i.exports;var r=a[e]={exports:{}};return t[e](r,r.exports,n),r.exports}(()=>{var t=n(574);const e=process.env.portsv;t.listen(e,(()=>{console.log("Server run port: ",e)}))})()})();